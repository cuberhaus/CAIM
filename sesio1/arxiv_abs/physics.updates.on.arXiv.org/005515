We present a high-throughput optogenetic illumination system capable of simultaneous closed-loop
light delivery to specified targets in populations of moving Caenorhabditis elegans. The instrument
addresses three technical challenges: it delivers targeted illumination to specified regions
of the animal's body such as its head or tail; it automatically delivers stimuli triggered upon the
animal's behavior; and it achieves high throughput by targeting many animals simultaneously.
The instrument was used to optogenetically probe the animal's behavioral response to competing
mechanosensory stimuli in the the anterior and posterior soft touch receptor neurons. Responses
to more than $10^4$ stimulus events from a range of anterior-posterior intensity combinations
were measured. The animal's probability of sprinting forward in response to a mechanosensory stimulus
depended on both the anterior and posterior stimulation intensity, while the probability of reversing
depended primarily on the posterior stimulation intensity. We also probed the animal's response
to mechanosensory stimulation during the onset of turning, a relatively rare behavioral event,
by delivering stimuli automatically when the animal began to turn. Using this closed-loop approach,
over $10^3$ stimulus events were delivered during turning onset at a rate of 9.2 events per worm-hour,
a greater than 25-fold increase in throughput compared to previous investigations. These measurements
validate with greater statistical power previous findings that turning acts to gate mechanosensory
evoked reversals. Compared to previous approaches, the current system offers targeted optogenetic
stimulation to specific body regions or behaviors with many-fold increases in throughput to better
constrain quantitative models of sensorimotor processing. 